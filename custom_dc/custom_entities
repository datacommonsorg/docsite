---
layout: default
title:  Work with non-place entities
nav_order: 4
parent: Build your own Data Commons
---

{:.no_toc}
# Work with non-place entities

This page shows you how to define custom entities or extend non-place base entities, which may be part of the process to add your data to your local instance. It assumes you are already familiar with the content in [Prepare and load your own data](custom_data.md).

Before creating new entities, please see [Determine if you need to create new entities](custom_data.md#entities) to determine if you can reuse existing entities and/or entity types from base Data Commons. 

> **Note**: It is not necessary to create new entities for your Data Commons instance if your data is aggregated by a place type, or an entity that already exists in the base. 

* TOC
{:toc}

## Overview

If you only need to extend an entity that already exists in base Data Commons, you use MCF to do so; skip to [Extend non-place base entities]()

Like variables, you can define entities using "implicit" or "explicit" schema:

- With implicit schema, you define _entities_ in CSV files using the schema described below, and define any new _entity types_ (if needed) in the `config.json` file. If you don't need any new entity types, this approach is strongly recommended as it is much simpler to set up.
- With explicit schema, you define entities and entity types in MCF. If you need new entity types, you may want the additional flexibility allowed by MCF.

> **Tip:** You can actually combine both of these options and get the best of both worlds: define entities in CSV files and entity types in MCF. 

You any case, you need to configure the new entities in the `config.json` file. You only need a single `config.json` for both entities and variables.

The [directory structure](custom_data.md#dir) is the same as for variables.

In the following sections, we'll describe both setting up the custom entities, as well as how to use them with custom statistical variables.

## Define custom entities using implicit schema

In this section, we will walk you through concrete examples of how to go about setting up your CSV and JSON files. 

### Step 1: Prepare the CSV files

You must use separate CSV files for defining entities, from those used for observations. If you are defining more than one type of entity (for example, a `Hospital` and a `School`), use a separate CSV file for each.

Each CSV file can contain as many columns as you need to define various properties of the entity. The columns can be in any order, with any heading. 

You can choose to specify a column that defines DCIDs for the entities, or you can just have the importer generate them for you. In the following examples, we'll assume that you will define the DCIDs yourself. 

{:.no_toc}
{: #ex11}
#### Example 1: New entities, existing entity type

For example, let's say you wanted to track the performance of individual hospitals in your state rather than at the aggregated state level. Base Data Commons already has an entity type [`Hospital`](https://datacommons.org/browser/Hospital){: target="_blank"} but you'll notice that there are no actual hospitals in the knowledge graph. The first step would be to add definitions for hospital entities. Here is an example of real-world data from U.S. Department of Health and Human Services for the state of Alaska:

```csv
ccn,name,address,city_name,City,zipCode,hospitalSubtype
22001,St Elias Specialty Hospital,4800 Cordova Street,Anchorage,geoId/02020,99503,Long Term
20001,Providence Alaska Medical Center,3200 Providence Drive,Anchorage,geoId/02020,Short Term
20008,Bartlett Regional Hospital,3260 Hospital Dr,Juneau,geoId/02110,99801,Short Term
21311,Ketchikan Medical Center,3100 Tongass Avenue,Ketchikan,geoId/02150,99901,Critical Access Hospitals
20017,Alaska Regional Hospital,2801 Debarr Road,Anchorage,geoId/02020,99508,Short Term
21301,Providence Valdez Medical Center,Po Box 550,Valdez,geoId/02261,99686,Critical Access Hospitals
21306,Providence KodigeoId/02 Island Medical Ctr,1915 East Rezanof Drive,Kodiak,geoId/02150,99615,Critical Access Hospitals
21304,Petersburg Medical Center,Po Box 589,Petersburg,geoId/02280,99833,Critical Access Hospitals
```
The CCN is a certification number that uniquely identifies U.S. hospitals. (We'll use it as the DCID.) Note that the "city" column uses the existing [`City`](https://datacommons.org/browser/City){: target="_blank"} DCID; later we'll declare that column as an existing entity, so that our new hospital entities will be linked to the `City` entity type in the knowledge graph. By contrast, since `zipCode` is not a DCID, it won't be used to link to any existing entities. 

> **Important:** Whenever you want to new entity properties to be linked to an existing entity, you _must_ use its DCID in the column heading. 

{:.no_toc}
{: #ex12}
#### Example 2: New entities, new entity type 

Here is a real-world example from the biomedical domain. In the U.S., pharmaceutical compounds are identified by "stems" (letter sequences) that can be combined together to define new non-proprietary drug names. But the pharmaceutical "stem" is not a concept that exists in schema.org. Therefore, you would define the entity type `Stem` in the `config.json` file (see below), while the following CSV file identifies some actual stems (entities):

```csv
Stem,Definition,Examples
ac,anti-inflammatory agents,bromfenac
zolac,anti-inflammatory;  pyrazole acetic acid derivatives,rovazolac
actant,pulmonary surfactants,"beractant, lucinactant, calfactant"
adenant,adensosine receptor antagonists,preladenant
adol,analgesics,tazadolene
adox,antibacterials,carbadox
```
{:.no_toc}
{: #ex13}
#### Example 3: Statistical variables, observations, and new entities 

If you are providing observations for custom entities, the observations should be in a separate file. 

Let's look at an example of statistical variables and observations with custom entities. Using the first example of hospital entities, here is how a CSV containing metrics for the hospitals might look. (In this particular case, the dataset uses a negative number, rather than a null value, to indicate that the data is not available for that observation.)

```csv
dcid,week,total_num_staffed_beds,num_staffed_adult_beds,num_staffed_inpatient_icu_beds,num_staffed_adult_inpatient_icu_beds,num_staffed_inpatient_icu_beds_occupied,num_staffed_adult_icu_beds_occupied
22001,2023-01-27,79,79,12,12,-999999,-999999
20001,2023-01-27,1262,1048,264,146,264,146
20017,2023-01-27,0,0,-999999,-999999,0,0
21301,2023-01-27,836,780,101,62,66,62
21306,2023-01-27,0,0,9,9,8,8
21304,2023-01-27,6,6,0,0,0,0
```
Here are the important things to note:
- The first column, namely the entity, _must_ be named `dcid`, and must contain the DCIDs of the entities you have defined elsewhere.

### Step 2: Write the config.json file

The next step is to create the `config.json` file to configure your new entities. Note that this is the same `config.json` file you use for variables. 

{:.no_toc}
{: #ex21}
#### Example 1: New entities, existing entity type

Here's an example of how a `config.json` file could look for our hospital data, in which case the `Hospital` entity type already exists. In this case, you only provide the entity type name, since all other properties of the type are already defined in the base knowledge graph.

```json
{
  "inputFiles": {
    "hospital_entities.csv": {
      "importType": "entities",
      "rowEntityType": "Hospital",
      "idColumn": "ccn",
      "entityColumns": [
        "City"
      ],
      "provenance": "Alaska Weekly Hospital Capacity"
    },
  },
  "entities": {
    "Hospital": {
    }
  },
  "sources": {
    "HHS Protect Public Data Hub": {
      "url": "https://public-data-hub-dhhs.hub.arcgis.com/",
      "provenances": {
        "Alaska Weekly Hospital Capacity": "https://public-data-hub-dhhs.hub.arcgis.com/datasets/d47bfcaac2544c2eb1fcfb3d36b5ed23_0/explore"
      }
    }
  }
}
```
Note the presence of the `entities` section and these important fields:

- `input_files`:
  - `importType`: By default this is `variables`; to tell the importer that you are adding entities in that CSV file, you must specify `entities`.
  - `rowEntityType`: This specifies the entity type that the entities are derived from. In this case, we specify an existing entity, [`Hospital`](https://datacommons.org/browser/Hospital){: target="_blank"}. Note that the entity must be identified by its DCID. It must also match the identifier in the `entities` section. 
  - `idColumn`: This is optional, and tells the importer to use the values in the specified column as DCIDs. In this case, we specify `ccn`, which indicates that the values in the `ccn` column should be used as the DCIDs for the entities. If you don't specify this field, Data Commons will just create DCIDs automatically.
  - `entityColumns`: This is also optional: if you want your new entities to be linked to an existing entity type (or types), you can specify the column(s) containing matching existing entities. For example, if you wanted to be able to aggregate your hospital data at the city level, you could specify [`City`](https://datacommons.org/browser/City){: target="_blank"} as an entity column. 
    Note that the heading of the column and its reference here must use the DCID of the entity. If you additionally wanted to aggregate at the zip code level, you would need to specify [`CensusZipCodeTabulationArea`](http://localhost:8080/browser/CensusZipCodeTabulationArea){: target="_blank"}, the existing DCID for "zip code", as the column heading here and in the CSV file.
- `entities`: You use this section to identify an existing entity type(s) or define an entirely new one. To link to an existing entity type, use its DCID as the entry ID. In our example this is `Hospital`. 
  
The other fields are explained in the [Data config file specification reference](config.md).

{:.no_toc}
{: #ex22}
#### Example 2: New entities, new entity type {#new-entity-json}

Here's an example of defining new entities _and_ a new entity type in the JSON file, building on the earlier "stem" example. In this example, `NameStem` is a new entity type, used for the `rowEntityType`. The `idColumn` field refers to the `Stem` column from the CSV to indicate that the DCIDs for the new entities are to be found n that column.

The configuration is mostly identical to the previous example, with a notable exception: since we are actually defining a new entity type, `NameStem`, we need to give it a name and description.

```json
{
  "inputFiles": {
    "usan.csv": {
      "importType": "entities",
      "rowEntityType": "NameStem",
      "idColumn": "Stem",
      "provenance": "United States Adopted Names approved stems"
    }
  },
  "entities": {
    "NameStem": {
      "name": "USAN Stem",
      "description": "A common stem for which chemical and/or pharmacologic parameters have been established. This is designated by the United States Adopted Names (USAN) Council."
    }
  },
  "sources": {
    "AMA": {
      "url": "https://www.ama-assn.org/",
      "provenances": {
        "United States Adopted Names approved stems": "https://www.ama-assn.org/about/united-states-adopted-names/united-states-adopted-names-approved-stems"
    }
  }
}
```

{:.no_toc}
{: #ex23}
#### Example 3: Statistical variables with new entities

Here's an example of the previous hospital data, covering both the entities and the statistical variables (we've left out the remaining 7 variables for brevity):

```json
{
  "inputFiles": {
    "hospital_entities.csv": {
      "importType": "entities",
      "rowEntityType": "Hospital",
      "idColumn": "ccn",
      "entityColumns": ["City"],
      "provenance": "Alaska Weekly Hospital Capacity"
    },
    "hospital_observations.csv": {
      "importType": "observations",
      "entityType": "Hospital",
      "provenance": "Alaska Weekly Hospital Capacity"
    }
  },
  "entities": {
    "Hospital": {
      "name": "Hospital"
    }
  },
  "variables": {
    "total_num_staffed_beds": {
      "name": "All beds",
      "description": "Weekly sum of all staffed beds per hospital",
      "searchDescriptions": [
        "Total number of beds in Alaska hospitals each week",
        "Total number of staffed beds in Alaska hospitals each week"
      ],
      "group": "Alaska Hospitals"
    },
    "num_staffed_adult_beds": {
      "name": "Beds for adults",
      "description": "Weekly sum of all staffed beds reserved for adults per hospital",
      "searchDescriptions": [
        "Number of beds for adults in Alaska hospitals each week",
        "Number of staffed beds for adults in Alaska hospitals each week"
      ],
      "group": "Alaska Hospitals"
    },
    ...
  },
  "sources": {
    "HHS Protect Public Data Hub": {
      "url": "https://public-data-hub-dhhs.hub.arcgis.com/",
      "provenances": {
        "Alaska Weekly Hospital Capacity": "https://public-data-hub-dhhs.hub.arcgis.com/datasets/d47bfcaac2544c2eb1fcfb3d36b5ed23_0/explore"
      }
    }
  }
}
```
## Define custom entities using explicit schema

In this section, we will walk you through concrete examples of how you can define new entities and variables in MCF, and set up the `config.json` file. For observations, you would still need to provide them in CSV files, as described in [Prepare the CSV observation files](custom_data.md#exp_csv}.

### Step 1: Define custom entities and entity types in MCF

Defining a custom entity type in MCF gives you more control of the fields you want to include as properties of the entity type than in `config.json` (which only allows for `name` and `description`). 

You can have a single MCF file or as many as you like. 

For entities and entity types, an MCF block definition must include the following fields:

- `Node`: This is the DCID of the entity or entity type you are defining.
- `typeOf`: For an entity type, this must be `Class`. For an entity, this must be the DCID of the entity type of which your entity is an instance (e.g. `Hospital`).
- `name`: This is the readable name that will be displayed in various parts ot the UI.

You can additionally define any number of key:value pairs.

{:.no_toc}
#### Example 1: New entities, existing entity type

Here is an example of the hospitals entities discussed earlier, with only 2 entities for brevity. These MCF blocks serve the same function as the [CSV file mentioned above](). It's a bit more tedious to provide the entity definitions in this fashion, and there isn't really any benefit.

```
Node: dcid:22001
name: "St Elias Specialty Hospital"
typeOf: dcid:Hospital
address: "4800 Cordova Street"
cityName: "Anchorage"
City: dcid:geoId/02
zipCode: 99503
hospitalSubType: "Long Term"

Node: dcid:20001
name: "Providence Alaska Medical Center"
typeOf: dcid:Hospital
address: "3200 Providence Drive"
City: dcid:geoId/02
cityName: "Anchorage"
zipCode: 99508
hospitalSubType: "Short Term"
...
```
Here are the important things to note:
- The `City` field (named for the DCID) ensures that the node (hospital) is associated with the existing `City` node. This is useful if, say, you wanted to aggregate data from multiple hospitals in the same city.
- Any fields that reference other existing nodes in the base graph must be prefixed by `dcid:` or `dcs:` or `schema:`, which are interchangeable. 

#### Example 2: New entities, new entity type

Here is an example of the aforementioned [`NameStem` entity type](). This MCF block serves the same function as the `config.json` `entities` section, but it adds a few other properties.

```
Node: dcid:NameStem
name: "US Adopted Name Stem"
typeOf: schema:Class
subClassOf: dcs:ChemicalSubstance
shortDisplayName: "USAN Stem"
description: "A common stem for which chemical and/or pharmacologic parameters have been established. This is designated by the United States Adopted Names (USAN) Council."
descriptionUrl: "https://www.ama-assn.org/about/united-states-adopted-names/united-states-adopted-names-approved-stems"
```

Once the entity type is defined here, it can then be referenced by entities in the MCF (or even in CSV). For example, here are a few of the `NameStem` entities we defined in CSV earlier, as they would be defined in MCF:

```
Node: dcid:ac
name: "ac"
typeOf: NameStem
definition: "anti-inflammatory agents"
examples: "bromfenac"

Node: dcid:adenant
name: "adenant"
typeOf: NameStem
definition: "adensosine receptor antagonists"
examples: "preladenant"
...
```

#### Example 3: Statistical variables with new entities

If you are defining new entities in MCF, you can mix statistical variables with entities in the same file, or in as many files as you like. For the hospital data, you could have an MCF file that looks like this:

```
Node: dcid:A22001
name: "St Elias Specialty Hospital"
typeOf: dcid:Hospital
address: "4800 Cordova Street"
cityName: "Anchorage"
City: dcid:geoId/02
zipCode: 99503
hospitalSubType: "Long Term"

Node:dcid:A20001
name: "Providence Alaska Medical Center"
typeOf: dcid:Hospital
address: "3200 Providence Drive"
City: dcid:geoId/02
cityName: "Anchorage"
zipCode: 99508
hospitalSubType: "Short Term"

...

Node: dcid:ccn/num_staffed_adult_beds
name: "Beds for adults"
typeOf: dcid:StatisticalVariable
populationType: dcid:Hospital
description: "Weekly sum of all staffed beds reserved for adults per hospital"
 
Node: dcid:num_staffed_inpatient_icu_beds
name: "Inpatient ICU beds"
typeOf: dcid:StatisticalVariable
populationType: dcid:Hospital
description: "Weekly sum of all staffed inpatient beds in the ICU per hospital"
...
```

### Step 2: Write the config.json file

The next step is to create the `config.json` file to configure your new entities. Note that this is the same `config.json` file you use for variables. 

With MCF, since your entities are already defined, you don't need to define them in `config.json`. You only need to specify any observations files you are using (if any) and define your sources. Note that you don't need to reference MCF files in `config.json` at all; the importer picks them up automatically.

```json
{
"hospital_observations.csv": {
      "importType": "observations",
      "entityType": "Hospital",
      "provenance": "Alaska Weekly Hospital Capacity"
    }
  },
  "sources": {
    "HHS Protect Public Data Hub": {
      "url": "https://public-data-hub-dhhs.hub.arcgis.com/",
      "provenances": {
        "Alaska Weekly Hospital Capacity": "https://public-data-hub-dhhs.hub.arcgis.com/datasets/d47bfcaac2544c2eb1fcfb3d36b5ed23_0/explore"
      }
    }
  }
}
```
{: #extend}
## Extend existing base non-place entities or entity types

It may be the case that entities exist already in base Data Commons, but you want to add more properties to them. To do, you can simply create an MCF file, and list out the additional properties. For example, let's say you 



