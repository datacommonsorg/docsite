<!DOCTYPE html>

<html lang="en">
<head>
  <title>Launch your Data Commons - Docs - Data Commons</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="icon" href="/assets/images/favicon.png" type="image/png"/>
  <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@300;400;500;700" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Google+Sans+Text:wght@300;400;500;700" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@600&family=Roboto&family=Material+Icons&display=swap" rel="stylesheet">
  <link href="/assets/css/styles.css" rel="stylesheet">
  <link rel="stylesheet" href="/assets/css/custom.css">
  
  
</head>
<body>
  <div id="main">
    <header id="main-header">
      <nav class="navbar navbar-light navbar-expand-lg col" id="main-nav">
        <div class="container-fluid">
          <div class="navbar-brand">
            <div id="main-header-logo">
                <a href="https://datacommons.org/">
                  <img src="/assets/images/dc-logo.svg" />
                </a>
            </div>
            <a href="https://datacommons.org">Data Commons</a>
            <!-- dot separater -->
            <span class="separator">&#8226;</span>
            <span><a href="/">Docs</a></span>
            </a>
          </div>
        <button class="navbar-toggler" type="button" data-toggle="collapse"
          data-target="#dc-main-nav">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse justify-content-md-end" id="dc-main-nav">
            <div class="gcse-searchbox-only"
              data-resultsUrl="https://datacommons.org/search"></div>
            </div>
            </div>
      </nav>
    </header>

    <main id="" class="container-fluid">
      <div class="row">
        <div id="main-side-nav" class="col-3">
          <div id="sidebar"><details class="parent" open>
          <summary>
            <a href="/" class="">How to use Data Commons</a>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="14" height="14">
  <path fill-rule="evenodd" clip-rule="evenodd" d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z"></path>
</svg>
          </summary>
          <ul id="node-3"><details class="child" >
                  <summary>
                    <a href="/what_is.html" class="">What is Data Commons?</a>
                    
                  </summary>
                  </details><details class="child" >
                  <summary>
                    <a href="/data_model.html" class="">Key concepts and common tasks</a>
                    
                  </summary>
                  </details><details class="child" >
                  <summary>
                    <a href="/glossary.html" class="">Glossary</a>
                    
                  </summary>
                  </details><details class="child" >
                  <summary>
                    <a href="/place_types.html" class="">Place types</a>
                    
                  </summary>
                  </details></ul></details><details class="parent" open>
          <summary>
            <a href="/datasets/" class="">Data sources</a>
            
          </summary>
          </details><details class="parent" open>
          <summary>
            <a href="/api/" class="">API - Query data programmatically</a>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="14" height="14">
  <path fill-rule="evenodd" clip-rule="evenodd" d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z"></path>
</svg>
          </summary>
          <ul id="node-63"><details class="child" >
                  <summary>
                    <a href="/api/rest/v2/" class="">REST (V2)</a>
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="14" height="14">
  <path fill-rule="evenodd" clip-rule="evenodd" d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z"></path>
</svg>
                  </summary>
                  <ul id="child-1"><details class="child" >
                          <summary>
                            <a href="/api/rest/v2/observation.html" class="">
                              
                              Get statistical observations
                            </a>
                            
                          </summary>
                          </details><details class="child" >
                          <summary>
                            <a href="/api/rest/v2/node.html" class="">
                              
                              Get node properties
                            </a>
                            
                          </summary>
                          </details><details class="child" >
                          <summary>
                            <a href="/api/rest/v2/resolve.html" class="">
                              
                              Resolve entities
                            </a>
                            
                          </summary>
                          </details><details class="child" >
                          <summary>
                            <a href="/api/rest/v2/sparql.html" class="">
                              
                              Query with SPARQL
                            </a>
                            
                          </summary>
                          </details><details class="child" >
                          <summary>
                            <a href="/api/rest/v2/troubleshooting.html" class="">
                              
                              Troubleshooting
                            </a>
                            
                          </summary>
                          </details></ul></details><details class="child" >
                  <summary>
                    <a href="/api/python/" class="">Python</a>
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="14" height="14">
  <path fill-rule="evenodd" clip-rule="evenodd" d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z"></path>
</svg>
                  </summary>
                  <ul id="child-2"><details class="child" >
                          <summary>
                            <a href="/api/python/place_in.html" class="">
                              
                              Get places within other places
                            </a>
                            
                          </summary>
                          </details><details class="child" >
                          <summary>
                            <a href="/api/python/stat_value.html" class="">
                              
                              Get a single statistical value for a place
                            </a>
                            
                          </summary>
                          </details><details class="child" >
                          <summary>
                            <a href="/api/python/stat_series.html" class="">
                              
                              Get time series for a place
                            </a>
                            
                          </summary>
                          </details><details class="child" >
                          <summary>
                            <a href="/api/python/stat_all.html" class="">
                              
                              Get statistical data for multiple places
                            </a>
                            
                          </summary>
                          </details><details class="child" >
                          <summary>
                            <a href="/api/python/property_label.html" class="">
                              
                              Get property labels of nodes
                            </a>
                            
                          </summary>
                          </details><details class="child" >
                          <summary>
                            <a href="/api/python/property_value.html" class="">
                              
                              Get property values of nodes
                            </a>
                            
                          </summary>
                          </details><details class="child" >
                          <summary>
                            <a href="/api/python/tutorials.html" class="">
                              
                              Tutorials
                            </a>
                            
                          </summary>
                          </details><details class="child" >
                          <summary>
                            <a href="/api/python/triple.html" class="">
                              
                              Get triples associated with nodes
                            </a>
                            
                          </summary>
                          </details></ul></details><details class="child" >
                  <summary>
                    <a href="/api/pandas/" class="">Pandas</a>
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="14" height="14">
  <path fill-rule="evenodd" clip-rule="evenodd" d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z"></path>
</svg>
                  </summary>
                  <ul id="child-3"><details class="child" >
                          <summary>
                            <a href="/api/pandas/time_series.html" class="">
                              
                              Get time series for a place
                            </a>
                            
                          </summary>
                          </details><details class="child" >
                          <summary>
                            <a href="/api/pandas/time_series_dataframe.html" class="">
                              
                              Get time series DataFrame
                            </a>
                            
                          </summary>
                          </details><details class="child" >
                          <summary>
                            <a href="/api/pandas/multivariate_dataframe.html" class="">
                              
                              Get multivariate DataFrame
                            </a>
                            
                          </summary>
                          </details></ul></details></ul></details><details class="parent" open>
          <summary>
            <a href="/api/sheets/" class="">Analyze data with Google Sheets</a>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="14" height="14">
  <path fill-rule="evenodd" clip-rule="evenodd" d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z"></path>
</svg>
          </summary>
          <ul id="node-73"><details class="child" >
                  <summary>
                    <a href="/api/sheets/tutorials/" class="">Tutorials</a>
                    
                  </summary>
                  </details><details class="child" >
                  <summary>
                    <a href="/api/sheets/get_name.html" class="">Get names associated with DCIDs</a>
                    
                  </summary>
                  </details><details class="child" >
                  <summary>
                    <a href="/api/sheets/places_in.html" class="">Get places contained in another place</a>
                    
                  </summary>
                  </details><details class="child" >
                  <summary>
                    <a href="/api/sheets/get_variable.html" class="">Get statistical variable values</a>
                    
                  </summary>
                  </details><details class="child" >
                  <summary>
                    <a href="/api/sheets/get_property.html" class="">Get node property values</a>
                    
                  </summary>
                  </details><details class="child" >
                  <summary>
                    <a href="/api/sheets/get_cohort_members.html" class="">Get members of a cohort</a>
                    
                  </summary>
                  </details></ul></details><details class="parent" open>
          <summary>
            <a href="/api/web_components/" class="">Embed data and visualizations in your own website</a>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="14" height="14">
  <path fill-rule="evenodd" clip-rule="evenodd" d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z"></path>
</svg>
          </summary>
          <ul id="node-80"><details class="child" >
                  <summary>
                    <a href="/api/web_components/bar" class="">Bar chart</a>
                    
                  </summary>
                  </details><details class="child" >
                  <summary>
                    <a href="/api/web_components/gauge" class="">Gauge chart</a>
                    
                  </summary>
                  </details><details class="child" >
                  <summary>
                    <a href="/api/web_components/highlight" class="">Highlight tile</a>
                    
                  </summary>
                  </details><details class="child" >
                  <summary>
                    <a href="/api/web_components/line" class="">Line chart</a>
                    
                  </summary>
                  </details><details class="child" >
                  <summary>
                    <a href="/api/web_components/map" class="">Map chart</a>
                    
                  </summary>
                  </details><details class="child" >
                  <summary>
                    <a href="/api/web_components/pie" class="">Pie chart</a>
                    
                  </summary>
                  </details><details class="child" >
                  <summary>
                    <a href="/api/web_components/ranking" class="">Ranking chart</a>
                    
                  </summary>
                  </details><details class="child" >
                  <summary>
                    <a href="/api/web_components/scatter" class="">Scatter plot</a>
                    
                  </summary>
                  </details><details class="child" >
                  <summary>
                    <a href="/api/web_components/slider" class="">Slider control</a>
                    
                  </summary>
                  </details></ul></details><details class="parent" open>
          <summary>
            <a href="/bigquery/" class="">Query with SQL/BigQuery</a>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="14" height="14">
  <path fill-rule="evenodd" clip-rule="evenodd" d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z"></path>
</svg>
          </summary>
          <ul id="node-81"><details class="child" >
                  <summary>
                    <a href="/bigquery/query_places.html" class="">Query places</a>
                    
                  </summary>
                  </details><details class="child" >
                  <summary>
                    <a href="/bigquery/query_property_places.html" class="">Query observations and properties of places</a>
                    
                  </summary>
                  </details><details class="child" >
                  <summary>
                    <a href="/bigquery/query_more_complex.html" class="">More complex queries</a>
                    
                  </summary>
                  </details><details class="child" >
                  <summary>
                    <a href="/bigquery/query_join_your_data.html" class="">Join with external data</a>
                    
                  </summary>
                  </details></ul></details><details class="parent" open>
          <summary>
            <a href="/contributing/" class="">Contribute to Data Commons</a>
            
          </summary>
          </details><details class="parent" open>
          <summary>
            <a href="/custom_dc/" class="">Build your own Data Commons</a>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="14" height="14">
  <path fill-rule="evenodd" clip-rule="evenodd" d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z"></path>
</svg>
          </summary>
          <ul id="node-83"><details class="child" >
                  <summary>
                    <a href="/custom_dc/quickstart.html" class="">Quickstart</a>
                    
                  </summary>
                  </details><details class="child" >
                  <summary>
                    <a href="/custom_dc/custom_data.html" class="">Prepare and load your own data</a>
                    
                  </summary>
                  </details><details class="child" >
                  <summary>
                    <a href="/custom_dc/custom_ui.html" class="">Customize the site</a>
                    
                  </summary>
                  </details><details class="child" >
                  <summary>
                    <a href="/custom_dc/build_image.html" class="">Build and run a custom image</a>
                    
                  </summary>
                  </details><details class="child" >
                  <summary>
                    <a href="/custom_dc/deploy_cloud.html" class="">Deploy to Google Cloud</a>
                    
                  </summary>
                  </details><details class="child" open>
                  <summary>
                    <a href="/custom_dc/launch_cloud.html" class=" active">Launch your Data Commons</a>
                    
                  </summary>
                  </details><details class="child" >
                  <summary>
                    <a href="/custom_dc/advanced.html" class="">Advanced setups</a>
                    
                  </summary>
                  </details><details class="child" >
                  <summary>
                    <a href="/custom_dc/troubleshooting.html" class="">Troubleshooting</a>
                    
                  </summary>
                  </details><details class="child" >
                  <summary>
                    <a href="/custom_dc/faq.html" class="">Frequently asked questions</a>
                    
                  </summary>
                  </details></ul></details><details class="parent" open>
          <summary>
            <a href="/resources.html" class="">Additional resources</a>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="14" height="14">
  <path fill-rule="evenodd" clip-rule="evenodd" d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z"></path>
</svg>
          </summary>
          <ul id="node-98"><details class="child" >
                  <summary>
                    <a href="/papers/" class="">Papers</a>
                    
                  </summary>
                  </details><details class="child" >
                  <summary>
                    <a href="/courseware/" class="">Educational materials</a>
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="14" height="14">
  <path fill-rule="evenodd" clip-rule="evenodd" d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z"></path>
</svg>
                  </summary>
                  <ul id="child-2"><details class="child" >
                          <summary>
                            <a href="/courseware/data_literacy/" class="">
                              
                              Data literacy with Data Commons
                            </a>
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="14" height="14">
  <path fill-rule="evenodd" clip-rule="evenodd" d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z"></path>
</svg>
                          </summary>
                          <ul id="grandchild-1"><li class="">
                                  <a href="/courseware/data_literacy/how_to_use.html" class="">
                                    How to use the course materials
                                  </a>
                                </li><li class="">
                                  <a href="/courseware/data_literacy/key_themes.html" class="">
                                    Key themes
                                  </a>
                                </li><li class="">
                                  <a href="/courseware/data_literacy/modules.html" class="">
                                    Modules
                                  </a>
                                </li></ul></details><details class="child" >
                          <summary>
                            <a href="/courseware/intro_data_science.html" class="">
                              
                              Introduction to data science
                            </a>
                            
                          </summary>
                          </details></ul></details></ul></details></div>
        </div>
        <div class="col-9">
          <div id="main-doc-content">
            
              
                <nav aria-label="Breadcrumb" id="main-breadcrumb">
                  <ol class="breadcrumb">
                    
                      <li class="breadcrumb-item">
                        <a href="/custom_dc/">
                          Build your own Data Commons
                        </a>
                      </li>
                    
                    <li class="breadcrumb-item active"><span>Launch your Data Commons </span></li>
                  </ol>
                </nav>
              
            
            <h1 class="no_toc" id="launch-your-data-commons">Launch your Data Commons</h1>

<ul id="markdown-toc">
  <li><a href="#overview" id="markdown-toc-overview">Overview</a></li>
  <li><a href="#access" id="markdown-toc-access">Restrict public access to your service</a></li>
  <li><a href="#replication" id="markdown-toc-replication">Increase replication of the services container</a></li>
  <li><a href="#redis" id="markdown-toc-redis">Improve database performance</a>    <ul>
      <li><a href="#use-a-caching-layer" id="markdown-toc-use-a-caching-layer">Use a caching layer</a></li>
      <li><a href="#boost-sql" id="markdown-toc-boost-sql">Boost SQL resources</a></li>
    </ul>
  </li>
  <li><a href="#analytics" id="markdown-toc-analytics">Add Google Analytics reporting</a>    <ul>
      <li><a href="#enable-analytics-tracking" id="markdown-toc-enable-analytics-tracking">Enable Analytics tracking</a></li>
      <li><a href="#custom-dimensions" id="markdown-toc-custom-dimensions">Report on custom dimensions</a></li>
    </ul>
  </li>
</ul>

<h2 id="overview">Overview</h2>

<p>When you are ready to launch your site to external traffic, there are many tasks you will need to perform, including:</p>

<ul>
  <li>Configure your Cloud Service to serve external traffic, over SSL. GCP offers many options for this; see <a href="https://cloud.google.com/run/docs/mapping-custom-domains#https-load-balancer" target="_blank">Mapping a domain using a global external Application Load Balancer</a>.</li>
  <li>Optionally, restrict access to your service; see <a href="#access">Restrict public access to your service</a>.</li>
  <li>Optionally, increase the number of Docker service container instances. See <a href="#replication">Increase the services container replication</a> for procedures.</li>
  <li>Optionally, add a caching layer to improve performance. This is recommended for all production Data Commons instances. We have provided specific procedures to set up a Redis Memorystore in <a href="#redis">Improve database performance</a>.</li>
  <li>Optionally, boost Cloud SQL instance resources if needed. See <a href="#boost-sql">Boost SQL resources</a></li>
  <li>Optionally, add <a href="https://marketingplatform.google.com/about/analytics/" target="_blank">Google Analytics</a> to track your website’s usage. Procedures for configuring Google Analytics support are in <a href="#analytics">Add Google Analytics tracking</a>.</li>
</ul>

<p>Throughout these procedures, we recommend using Terraform to create a production deployment.</p>

<blockquote>
  <p><strong>Note:</strong> If you make future updates to this deployment, we recommend always using Terraform to do so. If you use the Cloud Console or gcloud to make updates and try to run Terraform again, it will override any changes you have made outside of Terraform. For options that are available as variables in the Data Commons <code class="language-plaintext highlighter-rouge">variables.tf</code>, you must sync your production <code class="language-plaintext highlighter-rouge">terraform.tfvars</code> options to the same values you have set outside Terraform before running Terraform commands again. If you use the Cloud Console or gcloud to configure options that are not available as Data Commons variables, you <em>must not</em> run Terraform again.</p>
</blockquote>

<h2 id="access">Restrict public access to your service</h2>

<p>By default when you create a new Cloud Run service, it is set up with global public access. If you wish to restrict access to only authenticated and authorized users, you can do so by making the service <a href="https://cloud.google.com/run/docs/configuring/custom-audiences" target="_blank">private</a> and requring access tokens from your users. To set your instance to private:</p>

<ol>
  <li>Create a <a href="/custom_dc/deploy_cloud.html#multiple">production Terraform configuration file and Terraform workspace</a>, if you haven’t already done so.</li>
  <li>Edit the file to add the following line:
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make_dc_web_service_public = false
</code></pre></div>    </div>
  </li>
  <li>Switch to the production workspace and <a href="/custom_dc/deploy_cloud.html#multiple">run the Terraform deployment</a> as usual.</li>
</ol>

<p>Follow additional procedures in <a href="https://cloud.google.com/run/docs/authenticating/end-users" target="_blank">Authenticate users</a> to complete your setup.</p>

<h2 id="replication">Increase replication of the services container</h2>

<p>Google Cloud Run services use <a href="https://cloud.google.com/run/docs/about-instance-autoscaling" target="_blank">auto-scaling</a>, which means that the number of instances of your services container is increased or decreased according to the traffic the service is receiving. By default, the Terraform scripts set the minimum and maximum number of instances to 1. For production traffic, we suggest increasing the maximum to at least 3. (We recommend keeping the default minimum instances setting of 1, to avoid delays when new revisions are deployed.)</p>

<ol>
  <li>Create a <a href="/custom_dc/deploy_cloud.html#multiple">production Terraform configuration file and Terraform workspace</a>, if you haven’t already done so.</li>
  <li>Edit the file to add the following line:
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dc_web_service_max_instance_count = 3
</code></pre></div>    </div>
  </li>
  <li>Switch to the production workspace and <a href="/custom_dc/deploy_cloud.html#multiple">run the Terraform deployment</a> as usual.</li>
</ol>

<h2 id="redis">Improve database performance</h2>

<h3 id="use-a-caching-layer">Use a caching layer</h3>

<p>We recommend that you use a caching layer to improve the performance of your database. We recommend <a href="https://cloud.google.com/memorystore" target="_blank">Google Cloud Redis Memorystore</a>, a fully managed solution, which will boost the performance of both natural-language searches and regular database lookups in your site. Redis Memorystore runs as a standalone instance in a Google-managed virtual private cloud (VPC), and connects to your VPC network (“default” or otherwise) via <a href="https://cloud.google.com/vpc/docs/vpc-peering" target="_blank">direct peering</a>. Your Cloud Run service connects to the instance using a <a href="https://cloud.google.com/vpc/docs/serverless-vpc-access" target="_blank">VPC connector</a>.</p>

<p>The Terraform scripts set up a single Redis instance called <code><var>NAMESPACE</var>-datacommons-redis-instance</code>.</p>

<p>To configure caching using Terraform:</p>

<ol>
  <li>Create a <a href="/custom_dc/deploy_cloud.html#multiple">production Terraform configuration file and Terraform workspace</a>, if you haven’t already done so.</li>
  <li>Edit the file to add the following:
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> enable_redis = true
</code></pre></div>    </div>
  </li>
  <li>Switch to the production workspace and <a href="/custom_dc/deploy_cloud.html#multiple">run the Terraform deployment</a> as usual.</li>
</ol>

<p>It will take several minutes to create the Redis instance. To verify that queries are hitting the cache, see below.</p>

<h4 class="no_toc" id="verify-caching">Verify caching</h4>

<p>To verify that traffic is hitting the cache:</p>

<ol>
  <li>Run some queries against your running Cloud Run service.</li>
  <li>Go to <a href="https://console.cloud.google.com/memorystore/redis/instances" target="_blank">https://console.cloud.google.com/memorystore/redis/instances</a> for your project.</li>
  <li>Select the Redis instance that has just been created.</li>
  <li>Under <strong>Instance Functions</strong>, click <strong>Monitoring</strong>.</li>
  <li>Scroll to the <strong>Cache Hit Ratio</strong> graph. You should see a significant percentage of your traffic hitting the cache.</li>
</ol>

<h4 class="no_toc" id="boost-redis-resources">Boost Redis resources</h4>

<p>By default, the Terraform scripts configure the Redis instance with the following characteristics:</p>
<ul>
  <li>2 GiB memory reservation</li>
  <li>“Standard high-availability” tier, without read replicas</li>
</ul>

<p>If you encounter performance problems after launch, there are a few Redis parameters you can adjust. In particular, if needed, we suggest increasing the memory allocation.</p>

<ol>
  <li>Go to <a href="https://console.cloud.google.com/memorystore/redis/instances" target="_blank">https://console.cloud.google.com/memorystore/redis/instances</a> for your project and select your Redis instance.</li>
  <li>Go to <strong>Overview</strong> &gt; <strong>Monitoring</strong> and from the <strong>Chart</strong> menu, select <strong>Memory usage/Max memory graph</strong>.</li>
  <li>If you notice that memory usage is approaching the max memory, add the following variable in your production <code class="language-plaintext highlighter-rouge">.tfvars</code> file, with this recommended value:
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>redis_memory_size_gb = 4
</code></pre></div>    </div>
  </li>
  <li><a href="/custom_dc/deploy_cloud.html#multiple">Run the Terraform deployment</a> as usual.</li>
</ol>

<p>You may also want to enable read-only replication; you can set <code class="language-plaintext highlighter-rouge">redis_replica_count = 3</code> if needed.</p>

<h3 id="boost-sql">Boost SQL resources</h3>

<p>By default, the Terraform scripts configure the MySQL instance with the following characteristics:</p>
<ul>
  <li>2 CPUs</li>
  <li>20 GB SSD storage</li>
  <li>7680 MB memory</li>
</ul>

<p>If you are still noticing slow performance after adding a caching layer, you may need to increase resource reservations. In particular, if your storage is filling up, you will need to add more storage quota.</p>

<ol>
  <li>Go to <a href="https://console.cloud.google.com/sql/instances" target="_blank">https://console.cloud.google.com/sql/instances</a> for your project and select your MySQL instance.</li>
  <li>Go to <strong>Overview</strong> &gt; <strong>Monitoring</strong> and from the <strong>Chart</strong> menu, and select <strong>Storage Usage</strong>.</li>
  <li>If you notice that storage using is approaching quota, set the following variable in your production <code class="language-plaintext highlighter-rouge">.tfvars</code> file:
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql_storage_size_gb
</code></pre></div>    </div>
  </li>
  <li>Set a value that fits your database size.</li>
  <li><a href="/custom_dc/deploy_cloud.html#multiple">Run the Terraform deployment</a> as usual.</li>
</ol>

<p>You may also use the following variables to increase memory and CPU reservations if needed. You must set them together to align with the Cloud SQL Enterprise edition machine type constraints; for details, see the section <strong>Machine types for Cloud SQL Enterprise edition instances</strong> in <a href="https://cloud.google.com/sql/docs/mysql/instance-settings" target="_blank">https://cloud.google.com/sql/docs/mysql/instance-settings</a>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql_memory_size_mb
mysql_cpu_count
</code></pre></div></div>

<p>For example, this is legal because it aligns with the “db-n1-standard-4” machine type:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql_cpu_count = 4
mysql_memory_size_mb = 15360
</code></pre></div></div>

<p>But this is not legal because it does not align with any machine type:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql_cpu_count = 2
mysql_memory_size_mb = 15360
</code></pre></div></div>

<h2 id="analytics">Add Google Analytics reporting</h2>

<p>Google Analytics provides detailed reports on user engagement with your site. In addition, Data Commons provides a number of custom parameters you can use to report on specific attributes of a Data Commons site such as, search queries, specific page views, etc.</p>

<h3 id="enable-analytics-tracking">Enable Analytics tracking</h3>

<p>If you don’t already have a Google Analytics account, create one, following the procedures in <a href="https://support.google.com/analytics/answer/9304153" target="_blank">Set up Analytics for a website and/or app</a>. Record the Analytics tag ID assigned to your account.</p>

<p>Enable tracking:</p>

<ol>
  <li>Create a <a href="/custom_dc/deploy_cloud.html#multiple">production Terraform configuration file and Terraform workspace</a>, if you haven’t already done so.</li>
  <li>Edit the file to add the following line:
    <pre>google_analytics_tag_id = "<var>ANALYTICS_TAG_ID</var>"</pre>
  </li>
  <li>Switch to the production workspace and <a href="/custom_dc/deploy_cloud.html#multiple">run the Terraform deployment</a> as usual.</li>
</ol>

<p>Data collection will take a day or two to start and begin showing up in your reports.</p>

<script src="/assets/js/customdc-doc-tabs.js"></script>

<h3 id="custom-dimensions">Report on custom dimensions</h3>

<p>Data Commons exports many Google Analytics <a href="https://support.google.com/analytics/answer/12229021" target="_blank">custom events</a> and <a href="https://support.google.com/analytics/answer/13675006" target="_blank">parameters</a>, to allow Data Commons-specific features to be logged, such as search queries, specific page views, etc. You can use these to create custom reports and explorations. The full set is defined in <a href="https://github.com/datacommonsorg/website/blob/7f896a982e8567cd96a0d8b01d1cd5eaaf285974/static/js/shared/ga_events.ts" target="blank"><code class="language-plaintext highlighter-rouge">website/static/js/shared/ga_events.ts</code></a>. Before you can get reports on them, you need to create <a href="https://support.google.com/analytics/answer/14240153" target="blank">custom dimensions</a> from them.</p>

<p>To create a custom dimension for a Data Commons custom event:</p>

<ol>
  <li>In the <a href="https://analytics.google.com/analytics/web/" target="blank">Google Analytics dashboard</a> for your account, go to the <strong>Admin</strong> page.</li>
  <li>Select <strong>Data display</strong> &gt; <strong>Custom definitions</strong>.</li>
  <li>Click <strong>Create custom dimension</strong>.</li>
  <li>
    <p>Keep the <strong>Scope</strong> as <strong>Event</strong> and click the <strong>Event parameter</strong> &gt; <strong>Select event parameter</strong> drop-down to see the list of custom event parameters.</p>

    <p><img src="/assets/images/custom_dc/analytics1.png" alt="Custom parameters" width="400" /></p>
  </li>
  <li>Select the parameter you need, for example, <strong>query</strong>.</li>
  <li>Add a dimension name and description. These can be anything you want but the name should be meaningful as it will show up in reports; for example, <code class="language-plaintext highlighter-rouge">Search query</code>.</li>
  <li>When done, click <strong>Save</strong>.</li>
  <li>Select <strong>Data display</strong> &gt; <strong>Events</strong> and you should see a number of new custom events that have been added to your account.</li>
</ol>

<p>To create a report based on a custom event:</p>

<ol>
  <li>In the <a href="https://analytics.google.com/analytics/web/" target="blank">Google Analytics dashboard</a> for your account, go to the <strong>Explore</strong> page and select <strong>Blank - create a new exploration</strong>.</li>
  <li>Select <strong>Variables</strong> &gt; <strong>Dimensions</strong> &gt; <strong>+</strong> to open the <strong>Select dimensions</strong> window.</li>
  <li>
    <p>Select the <strong>Custom</strong>, select the dimension you want, for example, <strong>Search query</strong>, and click <strong>Import</strong>.</p>

    <p><img src="/assets/images/custom_dc/analytics2.png" alt="Custom parameters" width="400" /></p>
  </li>
  <li>Select <strong>Variables</strong> &gt; <strong>Metrics</strong> &gt; <strong>+</strong> to open the <strong>Select metrics</strong> window.</li>
  <li>Select the relevant metric you want, such as users, sessions, or views, etc. and click <strong>Import</strong>.</li>
  <li>Select <strong>Settings</strong> &gt; <strong>Rows</strong> &gt; <strong>Drop or select dimension</strong> and from the drop-down menu, select the dimension you want, such as <strong>Search query</strong>.</li>
  <li>Select <strong>Settings</strong> &gt; <strong>Values</strong> &gt; <strong>Drop or select metric</strong> and from the drop-down menu, select the metric of interest, such as users, sessions, views, etc.</li>
  <li>Edit any other settings you like and name the report. For the first 48 hours you will see <strong>(not set)</strong> for the first row. Afterwards, rows will be populated with real values.</li>
</ol>

<p><img src="/assets/images/custom_dc/analytics3.png" alt="Custom exploration" width="400" /></p>


          </div>
          <div style="text-align:center" id="metadata">
            <p>
             Page last updated: February 24, 2025 &#8226; <a target="_blank" href="https://docs.google.com/forms/d/e/1FAIpQLSf23mC17idzIpzg6v4frCh8iWTl9dxeb4iSTVgo0WiBvnv5ZA/viewform?usp=pp_url&entry.871991796=/custom_dc/launch_cloud.html">
              Send feedback about this page
              </a>
            </p>
          </div>
      </div>
    </main>

    <footer id="main-footer">
      <div id="sub-footer">
        <span class="brand-byline">
          <span class="brand-text">An initiative from</span>
          <img class="brand-logo" src="/assets/images/google-logo.svg" />
        </span>
        <div class="sub-footer-links">
          <a href="https://policies.google.com/terms">Terms and Conditions</a>
          <a href="https://policies.google.com/privacy?hl=en-US">Privacy Policy</a>
        </div>
      </div>
    </footer>
  </div>
  <script
    src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script
    src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
    integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
    crossorigin="anonymous"></script>
  <script async
    src="https://cse.google.com/cse.js?cx=010079880385165835740%3Aosnv3q-sw08"></script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-KWSES5WXZE"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-KWSES5WXZE', {
      client_storage: 'none',
      anonymize_ip: true,
    });
  </script>
  <script>
    /**
     * Add placeholder text for Google Custom Search Engine search box in the page header
     */
    window.addEventListener("load", function() {
      const googleCustomSearchInput = document.querySelector(".gsc-search-box input[name=\"search\"]");
      if (googleCustomSearchInput) {
        googleCustomSearchInput.placeholder = "Search docs";
      }
    });
  </script>
  <script src="/assets/js/tabs.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/anchor-js/anchor.min.js"></script>
  <script>
    anchors.add();
  </script>
</body>
</html>
